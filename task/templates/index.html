
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage</title>
    <!-- Link to Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/static/style_homepage.css">
    <style>
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background-color: #f8f9fa;
        }
        .topbar .nav-links {
            display: flex;
            gap: 10px;
        }
        .topbar .nav-links a {
            text-decoration: none;
            color: #007bff;
            display: flex;
            align-items: center;
        }
        .topbar .nav-links a img {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <!-- Topbar -->
    <div class="topbar">
        <div class="input-group">
            <input class="form-control" type="search" placeholder="Search" id="searchInput">
            <div class="input-group-append">
                <button type="submit" class="btn btn-outline-success">Search</button>
            </div>
        </div>
        <div class="nav-links">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('user.profile', id=current_user.id) }}">
                    <img src="{{ url_for('static', filename='profile_icon.png') }}" alt="Profile"> Profile
                </a>
                <a href="{{ url_for('task.accept') }}">
                    <img src="{{ url_for('static', filename='accept_task_icon.png') }}" alt="Accept Task"> Accept Task
                </a>
                <a href="{{ url_for('task.post') }}">
                    <img src="{{ url_for('static', filename='post_task_icon.png') }}" alt="Post Task"> Post Task
                </a>
                <a id="logout-link" href="{{ url_for('user.logout') }}">
                    <img src="{{ url_for('static', filename='logout_icon.png') }}" alt="Logout"> Logout
                </a>
            {% else %}
                <a href="{{ url_for('user.login') }}">
                    <img src="{{ url_for('static', filename='search_icon.png') }}" alt="Login"> Login
                </a>
                <a href="{{ url_for('user.register') }}">
                    <img src="{{ url_for('static', filename='profile_icon.png') }}" alt="Register"> Register
                </a>
            {% endif %}
        </div>
    </div>
    <!-- Page 1 -->
    <section class="container">
        <h1>Study Perth Assistant</h1>
        <!-- search result -->
        <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="searchModalLabel">Search Results</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>

                    </div>
                    <div class="modal-body" id="search-results"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3 col-sm-6 image-box">
                <img src="/static/Picture1.png" alt="Image 1" class="img-fluid">
                <div class="text-box text-center">
                    <a href="URL_HERE" class="no-decoration"><h2>Post questions</h2></a>
                    <p>Post your first question.</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 image-box">
                <img src="/static/Picture2.png" alt="Image 2" class="img-fluid">
                <div class="text-box text-center">
                    <a href="URL_HERE" class="no-decoration"><h2>Answer questions</h2></a>
                    <p>Answer your first question.</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 image-box">
                <img src="/static/Picture3.png" alt="Image 3" class="img-fluid">
                <div class="text-box text-center">
                    <a href="URL_HERE" class="no-decoration"><h2>Profile</h2></a>
                    <p>Get social with friends.</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 image-box">
                <img src="/static/Picture4.png" alt="Image 4" class="img-fluid">
                <div class="text-box text-center">
                    <a href="URL_HERE" class="no-decoration"><h2>Ranking</h2></a>
                    <p>Look at everyone's contributions.</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Page 2 -->
    <section class="container">
        <div class="row">
            <div class="col-md-6">
                <img src="/static/Page2.png" alt="Image" class="img-fluid">
            </div>
            <div class="col-md-6">
                <h1>We believe in the power of helping each other</h1>
                <div class="text-box">
                    <h2>Our original intention</h2>
                    <p class="adjustable-text">Study Perth Assistant hopes to help international students in Perth solve various problems encountered in life and study through voluntary mutual assistance, help them make more friends, better integrate into the University and community, and live a successful life.</p>
                </div>
            </div>
        </div>
    </section>
    <!-- Page 3 -->
    <section class="container">
        <h1 class="text-center">How to use? Just four simple steps</h1>
        <div class="row">
            <div class="col-md-3 col-sm-6">
                <div class="text-box text-center">
                    <h2>Step 1</h2>
                    <p>Create your Study Perth Assistant account.</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="text-box text-center">
                    <h2>Step 2</h2>
                    <p>Post questions or Answer questions.</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="text-box text-center">
                    <h2>Step 3</h2>
                    <p>Let's give each other good reviews after the questions be answered.</p>
                </div>
            </div>
        </div>
    </section>
    <!-- Page 4 -->
    <section class="container">
        <h1 class="text-center">Dashboard</h1>
        <div class="row">
            <div class="col">
                <div class="image-container">
                    <img src="/static/Picture1.png" alt="Image 1" class="img-fluid">
                    <button class="btn btn-primary mt-3 fetch-data-btn" data-endpoint="/user/get_top_users" data-toggle="modal" data-target="#dataModal">Fetch Data</button>
                </div>
            </div>
            <div class="col">
                <div class="image-container">
                    <img src="/static/Picture2.png" alt="Image 2" class="img-fluid">
                    <button class="btn btn-primary mt-3 fetch-data-btn" data-endpoint="/user/get_total_tasks" data-toggle="modal" data-target="#dataModal">Fetch Data</button>
                </div>
            </div>
            <div class="col">
                <div class="image-container">
                    <img src="/static/Picture3.png" alt="Image 3" class="img-fluid">
                    <button class="btn btn-primary mt-3 fetch-data-btn" data-endpoint="/user/get_task_types" data-toggle="modal" data-target="#dataModal">Fetch Data</button>
                </div>
            </div>
        </div>
    </section>


    
    <!-- 模态框 -->
    <div class="modal fade" id="dataModal" tabindex="-1" role="dialog" aria-labelledby="dataModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dataModalLabel">Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- 这里将展示后端数据 -->
                </div>
            </div>
        </div>
    </div>



    <!-- Links to JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>

document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {  // 检查是否按下Enter键
        let query = e.target.value;  // 获取输入框中的查询内容
        if (query) {  // 确保查询内容不为空
            let xhr = new XMLHttpRequest();  // 创建一个新的XMLHttpRequest对象
            xhr.open('GET', `/search?query=${encodeURIComponent(query)}`, true);  // 配置GET请求，包含查询参数
            xhr.onreadystatechange = function() {  // 定义回调函数，处理服务器响应
                if (xhr.readyState === 4) {  // 确保请求完成
                    let searchResults = document.getElementById('search-results');
                    if (xhr.status === 200) {  // 请求成功
                        let data = JSON.parse(xhr.responseText);  // 解析JSON响应数据
                        searchResults.innerHTML = '';
                        if (data.length === 0) {  // 没有找到结果
                            searchResults.innerHTML = "<p>No results found.</p >";
                        } else {  // 显示搜索结果
                            data.forEach(result => {
                                let item = `
                                    <div class="result-item">
                                        <h4><a href=" ">${result.title}</a ></h4>
                                        <p>${result.content}</p >
                                    </div>
                                `;
                                searchResults.innerHTML += item;
                            });
                        }
                    } else {  // 请求失败
                        searchResults.innerHTML = "<p>An error occurred while fetching search results.</p >";
                    }
                    new bootstrap.Modal(document.getElementById('searchModal')).show();  // 显示模态框
                }
            };
            xhr.send();  // 发送请求
        }
    }
});



$(document).ready(function() {
    // 监听按钮点击事件
    $(".fetch-data-btn").click(function() {
        // 获取按钮上的数据端点
        var endpoint = $(this).data("endpoint");
        // 发起 AJAX 请求
        $.ajax({
            url: endpoint,
            type: "GET",
            success: function(response) {
                // 处理成功响应
                console.log("Data received:", response);
                // 将数据按回答数量降序排列
                var sortedUsers = response.users.sort((a, b) => b.answer_count - a.answer_count);
                // 将数据展示到模态框中
                displayData(sortedUsers);
            },
            error: function(xhr, status, error) {
                // 处理错误
                console.error("Error:", error);
            }
        });
    });

    // 将数据展示到模态框中的函数
    function displayData(users) {
        // 获取模态框的内容区域
        var modalBody = $("#modal-body");
        // 清空现有内容
        modalBody.empty();
        // 遍历用户数据并添加到模态框中
        users.forEach(function(user, index) {
            var userHtml = `<div class="user-card">
                                <img src="/static/uploads/${user.avatar}" alt="User Avatar" class="img-fluid rounded-circle mb-3">
                                <p>${user.nickname}</p>
                                <p>Answer Count: ${user.answer_count}</p>
                            </div>`;
            modalBody.append(userHtml);
        });
    }
});




</script>
</body>
</html>